<!doctype html>




<html class="theme-next pisces" lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">






<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Whyte">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1">






<meta name="description" content="I Believe">
<meta property="og:type" content="website">
<meta property="og:title" content="Whyte&#39;s blogs">
<meta property="og:url" content="http://laosiji.tech/index.html">
<meta property="og:site_name" content="Whyte&#39;s blogs">
<meta property="og:description" content="I Believe">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Whyte&#39;s blogs">
<meta name="twitter:description" content="I Believe">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":true},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://laosiji.tech/">





  <title>Whyte's blogs - 谋定而后动，知止而有得</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?643dba5c4e93a7f7f7539b68f0c2dd63";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>











  
  
    
  

  <div class="container sidebar-position-left page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Whyte's blogs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">谋定而后动，知止而有得</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://laosiji.tech/Imitate-weibo-topic-Webpage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Whyte">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Whyte's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Imitate-weibo-topic-Webpage/" itemprop="url">Android 仿微博话题及网页链接效果</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-25T23:57:04+08:00">
                2017-07-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  1,307
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近项目有个功能需要，做成类似微博的话题及网页链接的UI样式。效果如下：<br></p>
<p></p><p style="text-align:center"><img src="http://image.readtalk.me/supportTopicAndWebpage.png-1"></p><p></p>
<h2 id="TextView实现setMovementMethod方法"><a href="#TextView实现setMovementMethod方法" class="headerlink" title="TextView实现setMovementMethod方法"></a>TextView实现setMovementMethod方法</h2><p>首先得让TextView支持网页链接及话题点击，可自定义链接按下的背景颜色，让TextView支持链接点击需要实现<strong>setMovementMethod</strong>方法。<br>具体实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalLinkMovementMethod</span> <span class="keyword">extends</span> <span class="title">LinkMovementMethod</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> LocalLinkMovementMethod sInstance;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LocalLinkMovementMethod <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;</div><div class="line">            sInstance = <span class="keyword">new</span> LocalLinkMovementMethod();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sInstance;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(@NonNull TextView widget, @NonNull Spannable buffer,</span></span></div><div class="line">                                @NonNull MotionEvent event) &#123;</div><div class="line">        <span class="keyword">int</span> action = event.getAction();</div><div class="line">        <span class="keyword">switch</span> (action) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_CANCEL:</div><div class="line">                <span class="comment">//移除按下的背景颜色</span></div><div class="line">                removeSpan(widget, buffer);</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</div><div class="line">                <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</div><div class="line"></div><div class="line">                x -= widget.getTotalPaddingLeft();</div><div class="line">                y -= widget.getTotalPaddingTop();</div><div class="line"></div><div class="line">                x += widget.getScrollX();</div><div class="line">                y += widget.getScrollY();</div><div class="line"></div><div class="line">                Layout layout = widget.getLayout();</div><div class="line">                <span class="keyword">int</span> line = layout.getLineForVertical(y);</div><div class="line">                <span class="keyword">int</span> off = layout.getOffsetForHorizontal(line, x);</div><div class="line"></div><div class="line">                ClickableSpan[] link = buffer.getSpans(off, off,</div><div class="line">                        ClickableSpan.class);</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (link.length != <span class="number">0</span>) &#123;</div><div class="line">                    ClickableSpan cs = link[<span class="number">0</span>];</div><div class="line">                    <span class="keyword">int</span> csStart = buffer.getSpanStart(cs);</div><div class="line">                    <span class="keyword">int</span> csEnd = buffer.getSpanEnd(cs);</div><div class="line">                    <span class="keyword">if</span> (off &gt;= csStart &amp;&amp; off &lt; csEnd &amp;&amp; off &lt; layout.getLineEnd(line)) &#123;</div><div class="line">                        <span class="keyword">if</span> (action == MotionEvent.ACTION_UP) &#123;</div><div class="line">                            <span class="comment">//移除按下的背景颜色</span></div><div class="line">                            removeSpan(widget, buffer);</div><div class="line">                            link[<span class="number">0</span>].onClick(widget);</div><div class="line">                        &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            <span class="comment">//增加按下的背景颜色</span></div><div class="line">                            BackgroundColorSpan span = <span class="keyword">new</span> BackgroundColorSpan(</div><div class="line">                                    widget.getResources().getColor(R.color.color_selected));</div><div class="line">                            buffer.setSpan(span, csStart, csEnd,</div><div class="line">                                    Spanned.SPAN_MARK_POINT);</div><div class="line">                            widget.setText(buffer);</div><div class="line">                            Selection.setSelection(buffer,</div><div class="line">                                    buffer.getSpanStart(link[<span class="number">0</span>]),</div><div class="line">                                    buffer.getSpanEnd(link[<span class="number">0</span>]));</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> Touch.onTouchEvent(widget, buffer, event);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">removeSpan</span><span class="params">(@NonNull TextView widget, @NonNull Spannable buffer)</span> </span>&#123;</div><div class="line">    BackgroundColorSpan[] spans = buffer.getSpans(<span class="number">0</span>, buffer.length(),</div><div class="line">            BackgroundColorSpan.class);</div><div class="line">    <span class="keyword">for</span> (BackgroundColorSpan span : spans) &#123;</div><div class="line">        buffer.removeSpan(span);</div><div class="line">        widget.setText(buffer);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="支持话题及Url点击跳转"><a href="#支持话题及Url点击跳转" class="headerlink" title="支持话题及Url点击跳转"></a>支持话题及Url点击跳转</h2><p>支持话题及Url点击跳转需要用到<strong>SpannableString</strong>类，需要调用<strong>setSpan(Object what, int start, int end, int flags)</strong>方法来设置样式。<br>说一下参数的具体作用：</p>
<ul>
<li><p>what是具体样式的实现对象，样式的具体种类有：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">AbsoluteSizeSpan 指定文字大小</div><div class="line">TypefaceSpan 可以设置不同的字体</div><div class="line">AlignmentSpan.Standard 标准文本对齐</div><div class="line">BackgroundColorSpan 文本背景颜色</div><div class="line">ForegroundColorSpan 文字字体颜色</div><div class="line">LeadingMarginSpan 文本缩进</div><div class="line">TabStopSpan 制表位偏移样式</div><div class="line">TextAppearanceSpan 使用style文件来定义文本样式</div><div class="line">RelativeSizeSpan 对于文本设定的大小的相对比例</div><div class="line">ScaleXSpan 将字体按比例进行横向缩放</div><div class="line">URLSpan 可以打开一个链接</div><div class="line">StyleSpan 正常、粗体、斜体和同时加粗倾斜四种样式</div><div class="line">StrikethroughSpan 删除线样式</div><div class="line">QuoteSpan 在文本左侧添加一条表示引用的竖线</div><div class="line">UnderlineSpan 给一段文字加上下划线</div><div class="line">SubscriptSpan 脚注样式，比如化学式的常见写法</div><div class="line">SuperscriptSpan 上标样式，比如数学上的次方运算</div><div class="line">BulletSpan 文本着重样式，类似于HTML中的标签的圆点效果</div><div class="line">DrawableMarginSpan 、IconMarginSpan 图片+Margin样式</div><div class="line">ImageSpan 图片样式，主要用于在文本中插入图片 聊天中的emoji表情显示用的就是这个</div><div class="line">MaskFilterSpan 文本滤镜 目前只有模糊效果和浮雕效果</div><div class="line">RasterizerSpan 光栅化</div><div class="line">ClickableSpan 实现点击事件的样式</div></pre></td></tr></table></figure>
</li>
<li><p>start则是该样式开始的位置</p>
</li>
<li>end对应的是样式结束的位置</li>
<li>参数flags，定义在Spannable中的常量，常用的有：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Spanned.SPAN_EXCLUSIVE_EXCLUSIVE --- 不包含两端start和end所在的端点        (a,b)</div><div class="line">Spanned.SPAN_EXCLUSIVE_INCLUSIVE --- 不包含端start，但包含end所在的端点     (a,b]</div><div class="line">Spanned.SPAN_INCLUSIVE_EXCLUSIVE --- 包含两端start，但不包含end所在的端点   [a,b)</div><div class="line">Spanned.SPAN_INCLUSIVE_INCLUSIVE --- 包含两端start和end所在的端点          [a,b]</div></pre></td></tr></table></figure>
<p>实现我的现在的功能，目前只需要用到<strong>ClickableSpan</strong>样式。如果需要用到其他的样式，可以参考<a href="http://www.jianshu.com/p/f004300c6920" target="_blank" rel="external">第一个</a>、<a href="http://blog.csdn.net/lixin84915/article/details/8110667" target="_blank" rel="external">第二个</a>、<a href="http://blog.csdn.net/lixin84915/article/details/8111337" target="_blank" rel="external">第三个</a></p>
<h3 id="支持Url点击"><a href="#支持Url点击" class="headerlink" title="支持Url点击"></a>支持Url点击</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 支持url点击</div><div class="line"> * <span class="doctag">@param</span> source</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUrl</span><span class="params">(CharSequence source)</span> </span>&#123;</div><div class="line">    Pattern defaultPattern = Pattern.compile(WebUtils.DYNAMIC_URL_REGEX);</div><div class="line">    Matcher matcher = defaultPattern.matcher(source);</div><div class="line">    <span class="keyword">while</span> (matcher.find()) &#123;</div><div class="line">        <span class="keyword">final</span> String find = matcher.group();</div><div class="line">        <span class="keyword">if</span> (!WebUtils.isEmail(find)) &#123;</div><div class="line">            <span class="keyword">int</span> start = matcher.start();</div><div class="line">            <span class="keyword">int</span> end = matcher.end();</div><div class="line"></div><div class="line">            <span class="keyword">int</span> length = find.length();</div><div class="line">            <span class="keyword">int</span> index = -<span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (find.charAt(i) &gt;= <span class="number">127</span>) &#123;</div><div class="line">                    index = i;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">final</span> String ff;</div><div class="line">            <span class="keyword">if</span> (index &gt; <span class="number">0</span>) &#123;</div><div class="line">                ff = find.substring(<span class="number">0</span>, index);</div><div class="line">                end = start + ff.length();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                ff = find;</div><div class="line">            &#125;</div><div class="line">            setSpan(<span class="keyword">new</span> Clickable(<span class="keyword">new</span> URLClickListener(ff)), start, end, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">URLClickListener</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String url;</div><div class="line"></div><div class="line">    URLClickListener(String url) &#123;</div><div class="line">        <span class="keyword">this</span>.url = url;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View arg0)</span> </span>&#123;</div><div class="line">        Toast.makeText(BaseApplication.getInstance(), <span class="string">"click 网址："</span> + url, Toast.LENGTH_SHORT).show();</div><div class="line">        WebUtils.openUrl(url);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="支持话题点击"><a href="#支持话题点击" class="headerlink" title="支持话题点击"></a>支持话题点击</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 支持话题点击</div><div class="line"> * <span class="doctag">@param</span> source</div><div class="line"> * <span class="doctag">@param</span> topic</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initTopic</span><span class="params">(CharSequence source, String[] topic)</span> </span>&#123;</div><div class="line">    StringBuilder builder = <span class="keyword">new</span> StringBuilder();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; topic.length; i++) &#123;</div><div class="line">        builder.append(WebUtils.regexSpecial(topic[i]));</div><div class="line">        <span class="keyword">if</span> (i &lt; topic.length - <span class="number">1</span>) &#123;</div><div class="line">            builder.append(<span class="string">"|"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    String regex = <span class="string">"#(?:"</span> + builder.toString() + <span class="string">")#"</span>;</div><div class="line">    Pattern p = Pattern.compile(regex);</div><div class="line">    Matcher matcher = p.matcher(source);</div><div class="line">    <span class="keyword">while</span> (matcher.find()) &#123;</div><div class="line">        <span class="keyword">final</span> String find = matcher.group();</div><div class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(find)) &#123;</div><div class="line">            <span class="keyword">int</span> start = matcher.start();</div><div class="line">            <span class="keyword">int</span> end = matcher.end();</div><div class="line">            setSpan(<span class="keyword">new</span> Clickable(<span class="keyword">new</span> TopicClickListener(find)), start, end, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">TopicClickListener</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String text;</div><div class="line"></div><div class="line">    TopicClickListener(String text) &#123;</div><div class="line">        <span class="keyword">this</span>.text = text;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View widget)</span> </span>&#123;</div><div class="line">        String trimText = text.substring(<span class="number">1</span>, text.length() - <span class="number">1</span>);</div><div class="line">        Toast.makeText(BaseApplication.getInstance(), <span class="string">"click 话题："</span> + trimText, Toast.LENGTH_SHORT).show();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Url链接替换成网页链接"><a href="#Url链接替换成网页链接" class="headerlink" title="Url链接替换成网页链接"></a>Url链接替换成网页链接</h2><p><strong>SpannableStringBuilder</strong>很强大，可以实现很多效果，目前只用它替换Url链接成“网页链接”，具体实现代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> SpannableStringBuilder <span class="title">append</span><span class="params">(CharSequence text)</span> </span>&#123;</div><div class="line">    SpannableStringBuilder builder = <span class="keyword">super</span>.append(text);</div><div class="line"></div><div class="line">    <span class="keyword">final</span> String REPLACE_STRING = <span class="string">"\t"</span> + BaseApplication.getInstance().getString(R.string.url_replace_string);</div><div class="line"></div><div class="line">    Pattern p = Pattern.compile(WebUtils.DYNAMIC_URL_REGEX, Pattern.CASE_INSENSITIVE);</div><div class="line">    Matcher matcher = p.matcher(text);</div><div class="line">    <span class="keyword">int</span> offset = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (matcher.find()) &#123;</div><div class="line">        <span class="keyword">final</span> String find = matcher.group();</div><div class="line">        <span class="keyword">if</span> (!WebUtils.isEmail(find)) &#123;</div><div class="line">            <span class="keyword">int</span> start = matcher.start();</div><div class="line">            <span class="keyword">int</span> end = matcher.end();</div><div class="line">            <span class="keyword">int</span> length = find.length();</div><div class="line">            <span class="keyword">int</span> index = -<span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</div><div class="line">                <span class="keyword">if</span> (find.charAt(i) &gt;= <span class="number">127</span>) &#123;</div><div class="line">                    index = i;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">final</span> String ff;</div><div class="line">            <span class="keyword">if</span> (index &gt; <span class="number">0</span>) &#123;</div><div class="line">                ff = find.substring(<span class="number">0</span>, index);</div><div class="line">                end = start + ff.length();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                ff = find;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">int</span> replaceStart = start - offset;</div><div class="line">            <span class="keyword">int</span> replaceEnd = end - offset;</div><div class="line">            builder.replace(replaceStart, replaceEnd, REPLACE_STRING);</div><div class="line">            Drawable drawable = BaseApplication.getInstance().getResources().getDrawable(R.mipmap.ic_dynamic_link_bound);</div><div class="line">            drawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight());</div><div class="line">            setSpan(<span class="keyword">new</span> ImageSpan(drawable, DynamicDrawableSpan.ALIGN_BASELINE)</div><div class="line">                    , replaceStart, replaceStart + (<span class="string">"\t"</span>.length()), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</div><div class="line">            offset += ff.length() - REPLACE_STRING.length();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> builder;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>以上贴出来的主要是一些核心代码，获取<a href="https://github.com/whyteH/SupportTopicAndWebpage" target="_blank" rel="external">源码</a>，运行查看最终效果。</p>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://laosiji.tech/Regex-matcher-phone-by-text/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Whyte">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Whyte's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Regex-matcher-phone-by-text/" itemprop="url">在一段文本中用正则匹配是否有手机号码</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-24T21:09:06+08:00">
                2017-07-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Regex/" itemprop="url" rel="index">
                    <span itemprop="name">Regex</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  222
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在项目中遇到一个这样的需求：在一段文本中匹配出手机号码，并高亮显示，用于点击拨打电话，发送短信等。<br>查阅了正则表达式的相关资料，最终找到了解决方案。</p>
<h2 id="负向零宽断言"><a href="#负向零宽断言" class="headerlink" title="负向零宽断言"></a>负向零宽断言</h2><h3 id="零宽度负预测先行断言"><a href="#零宽度负预测先行断言" class="headerlink" title="零宽度负预测先行断言"></a>零宽度负预测先行断言</h3><p>断言此位置的后面不能匹配表达式</p>
<h3 id="零宽度负回顾后发断言"><a href="#零宽度负回顾后发断言" class="headerlink" title="零宽度负回顾后发断言"></a>零宽度负回顾后发断言</h3><p>断言此位置的前面不能匹配表达式</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 零宽度负预测先行断言 (?!exp)</div><div class="line"> * 零宽度负回顾后发断言 (?\&lt;!exp)</div><div class="line"> * 匹配手机号码的前面和后面都不能为数字</div><div class="line"> * <span class="doctag">@param</span> source 传入的文本</div><div class="line"> * <span class="doctag">@return</span></div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isMatchPhone</span><span class="params">(String source)</span> </span>&#123;</div><div class="line">    Pattern p = Pattern.compile(<span class="string">"(?&lt;![\\d])1[3|4|5|7|8][0-9]&#123;9&#125;(?!\\d)"</span>);</div><div class="line">    Matcher matcher = p.matcher(source);</div><div class="line">    <span class="keyword">return</span> matcher.find();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line">System.out.println(isMatchPhone(<span class="string">"hhh18888888888j"</span>)); <span class="comment">//true，如果不符合则为false</span></div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://laosiji.tech/Git-ignored-tracked/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Whyte">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Whyte's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Git-ignored-tracked/" itemprop="url">处理git无法忽略未提交的修改文件</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-24T21:01:56+08:00">
                2017-07-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Git/" itemprop="url" rel="index">
                    <span itemprop="name">Git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  188
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在我们使用git作为代码管理器的时候，有时候会遇到文件没有在<strong>gitignore</strong>中添加忽略就提交了，这时可能在其他地方把代码clone下来，而且修改了里面的内容，才添加到<strong>gitignore</strong>里面，push代码后，发现无法添加到<strong>gitignore</strong>。再次修改文件内容又可以commit。<br>这时候文件右侧会提示 <strong>ignored, tracked with git</strong>（我用的编辑器是Intellij，其他编辑器未知）</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>处理指定单个文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git rm --cached &lt;文件的名称&gt; </div><div class="line"></div><div class="line">如：git rm --cached kotlinc.xml</div></pre></td></tr></table></figure>
<p>批量处理文件夹里面的问题</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git rm -r --cached &lt;文件夹的名称&gt;</div><div class="line">如：git rm -r --cached .idea</div></pre></td></tr></table></figure>
<p>问题完美解决<br><a href="https://stackoverflow.com/questions/936249/how-to-stop-tracking-and-ignore-changes-to-a-file-in-git" target="_blank" rel="external">参考地址</a></p>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://laosiji.tech/Throttle-click_view/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Whyte">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Whyte's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Throttle-click_view/" itemprop="url">解决按钮重复点击重复响应的问题</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-17T21:18:02+08:00">
                2017-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  205
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们在项目中，按钮点击跳转页面或者执行某个事件时，有时候需要防止用户重复点击，防止重复执行某个事件或接口调用等。这时候就需要用到JakeWharton大神的<a href="https://github.com/JakeWharton/RxBinding" target="_blank" rel="external">RxBinding</a></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>引用依赖包</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">compile</span> <span class="string">'io.reactivex.rxjava2:rxjava:2.1.1'</span></div><div class="line"><span class="comment">//这个是基于上面的rxjava的</span></div><div class="line"><span class="keyword">compile</span> <span class="string">'com.jakewharton.rxbinding2:rxbinding:2.0.0'</span></div></pre></td></tr></table></figure>
<p>一个普通的View点击</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">RxView.clicks(btnClick).throttleFirst(<span class="number">1</span>, TimeUnit.SECONDS).subscribe(</div><div class="line">        <span class="keyword">new</span> Consumer&lt;Object&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(@NonNull Object o)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"click me"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">);</div></pre></td></tr></table></figure>
<p>如果想控制Menu的点击，也可以这样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">RxMenuItem.clicks(searchItem).throttleFirst(<span class="number">1</span>, TimeUnit.subscribe(</div><div class="line">        <span class="keyword">new</span> Consumer&lt;Object&gt;() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(@NonNull Object o)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">                Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"click me"</span>, Toast.ENGTH_SHORT).show();</div><div class="line">           &#125;</div><div class="line">        &#125;</div><div class="line">);</div></pre></td></tr></table></figure>
<p>在项目中主要用的就是这两个，RxBinding还有许多好用的方法值得探究。。</p>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://laosiji.tech/Kotlin-five/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Whyte">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Whyte's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Kotlin-five/" itemprop="url">跟我一起学Kotlin语法糖（五）——委托之委托类及委托属性</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-10T22:01:47+08:00">
                2017-07-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kotlin/" itemprop="url" rel="index">
                    <span itemprop="name">Kotlin</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  1,158
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>委托模式是软件设计模式中的一项基本技巧。<strong>有两个对象参与处理同一个请求，接受请求的对象将请求委托给另一个对象来处理。这就是委托。</strong> 委托模式是一项基本技巧，许多其他的模式，如状态模式、策略模式、访问者模式本质上是在更特殊的场合采用了委托模式。<strong>可以用委托模式来替代传统的继承</strong>。</p>
</blockquote>
<h2 id="委托类"><a href="#委托类" class="headerlink" title="委托类"></a>委托类</h2><p>先来看一下，在我们熟悉的Java代码中常用的委托模式是怎么去实现的，以便于下一步，我们去了解Kotlin中的委托。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">I</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">L</span> <span class="keyword">implements</span> <span class="title">I</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"L"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">L1</span> <span class="keyword">implements</span> <span class="title">I</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"L1"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">L2</span> <span class="keyword">implements</span> <span class="title">I</span> </span>&#123;</div><div class="line">    <span class="comment">//将L对象委托为I接口，再通过I去调用</span></div><div class="line">    <span class="keyword">private</span> I i = <span class="keyword">new</span> L();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</div><div class="line">        i.f();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 新建L对象</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toL</span><span class="params">()</span> </span>&#123;</div><div class="line">        i = <span class="keyword">new</span> L();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 新建L1对象</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toL1</span><span class="params">()</span> </span>&#123;</div><div class="line">        i = <span class="keyword">new</span> L1();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">    L2 c = <span class="keyword">new</span> L2();</div><div class="line">    c.f();<span class="comment">//输出 L</span></div><div class="line">    c.toL1();</div><div class="line">    c.f();<span class="comment">//输出 L1</span></div><div class="line">    c.toL();</div><div class="line">    c.f();<span class="comment">//输出 L</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来看一下Kotlin中委托的实现</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">P</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">print</span><span class="params">()</span></span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">P1</span> : <span class="type">P &#123;</span></span></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">print</span><span class="params">()</span></span> &#123;</div><div class="line">        println(<span class="string">"p1"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">P2</span> : <span class="type">P &#123;</span></span></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">print</span><span class="params">()</span></span> &#123;</div><div class="line">        println(<span class="string">"p2"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//超类型列表中的by子句表示b将会在 P3 中内部存储，并且编译器将生成转发给b的所有P的方法。</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">P3</span></span>(b: P) : P <span class="keyword">by</span> b</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</div><div class="line">    P3(P1()).print()<span class="comment">//输出 p1</span></div><div class="line">    P3(P2()).print()<span class="comment">//输出 p2</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>是不是语法超级简洁。</p>
<h2 id="委托属性"><a href="#委托属性" class="headerlink" title="委托属性"></a>委托属性</h2><p>包含了下面几种常用的操作</p>
<ul>
<li>延迟属性（lazy properties）: 其值只在首次访问时计算，</li>
<li>可观察属性（observable properties）: 监听器会收到有关此属性变更的通知，</li>
<li>把多个属性储存在一个Map集合中，而不是每个存在单独的字段中。</li>
</ul>
<p>基本的语法： val/var &lt;属性名&gt;: &lt;类型&gt; by &lt;表达式&gt;</p>
<p>基本的委托实现</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> p: String <span class="keyword">by</span> Delegate()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Delegate</span> </span>&#123;</div><div class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(thisRef: <span class="type">Any</span>?, property: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: String &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"<span class="subst">$thisRef</span>, thank you for delegating '<span class="subst">$&#123;property.name&#125;</span>' to me!"</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(thisRef: <span class="type">Any</span>?, property: <span class="type">KProperty</span>&lt;*&gt;, value: <span class="type">String</span>)</span></span> &#123;</div><div class="line">        println(<span class="string">"<span class="subst">$value</span> has been assigned to '<span class="subst">$&#123;property.name&#125;</span> in <span class="subst">$thisRef</span>.'"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line"><span class="keyword">val</span> a = Example()</div><div class="line">println(a.p)<span class="comment">//Example@1099f62, thank you for delegating 'p' to me!</span></div><div class="line">a.p = <span class="string">"a"</span><span class="comment">//a has been assigned to 'p in Example@1099f62.'</span></div></pre></td></tr></table></figure>
<h3 id="延迟属性"><a href="#延迟属性" class="headerlink" title="延迟属性"></a>延迟属性</h3><p><strong>lazy()</strong>是接受一个lambda并返回一个Lazy<t>实例的函数，返回的实例可以作为实现延迟属性的委托： 第一次调用get()会执行已传递给lazy()的lamda表达式并记录结果，后续调用get()只是返回记录的结果。</t></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> lazyValue: String <span class="keyword">by</span> lazy &#123;</div><div class="line">    println(<span class="string">"computed!"</span>)</div><div class="line">    <span class="string">"Hello"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</div><div class="line">    println(lazyValue)</div><div class="line">    println(lazyValue)</div><div class="line">&#125;</div><div class="line"><span class="comment">//输出：</span></div><div class="line"><span class="comment">//computed!</span></div><div class="line"><span class="comment">//Hello</span></div><div class="line"><span class="comment">//Hello</span></div></pre></td></tr></table></figure>
<p>默认情况下，对于lazy属性的求值是同步锁的（synchronized）：该值只在一个线程中计算，并且所有线程会看到相同的值。<strong>下面的代码等价于上面的代码</strong>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> lazyValue: String <span class="keyword">by</span> lazy(LazyThreadSafetyMode.SYNCHRONIZED) &#123;</div><div class="line">    println(<span class="string">"computed!"</span>)</div><div class="line">    <span class="string">"Hello"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果不需要初始化同步锁，这样多个线程可以同步执行，那么可以这样写。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> lazyValue: String <span class="keyword">by</span> lazy(LazyThreadSafetyMode.PUBLICATION) &#123;</div><div class="line">    println(<span class="string">"computed!"</span>)</div><div class="line">    <span class="string">"Hello"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果确定初始化，是发生在单个线程，那么可以如下写，就不会有任何线程安全的保证和相关的开销。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> lazyValue: String <span class="keyword">by</span> lazy(LazyThreadSafetyMode.NONE) &#123;</div><div class="line">    println(<span class="string">"computed!"</span>)</div><div class="line">    <span class="string">"Hello"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="可观察属性"><a href="#可观察属性" class="headerlink" title="可观察属性"></a>可观察属性</h3><p>接受两个参数：初始值和修改时回调处理（当给属性赋值后会调用该回调处理，有三个参数：被赋值的属性、旧值和新值）</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> name: String <span class="keyword">by</span> Delegates.observable(<span class="string">"&lt;no name&gt;"</span>) &#123;</div><div class="line">        prop, old, new -&gt;</div><div class="line">        println(<span class="string">"<span class="subst">$old</span> -&gt; <span class="subst">$new</span>"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</div><div class="line">    <span class="keyword">val</span> user = User()</div><div class="line">    user.name = <span class="string">"first"</span></div><div class="line">    user.name = <span class="string">"second"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//输出</span></div><div class="line"><span class="comment">//&lt;no name&gt; -&gt; first</span></div><div class="line"><span class="comment">//first -&gt; second</span></div></pre></td></tr></table></figure>
<p>如果想能够截获一个赋值并“否决”它，就使用<strong>vetoable()</strong>取代<strong>observable()</strong>。在属性被赋新值生效之前会调用传递给<strong>vetoable</strong>的处理程序。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> name: String <span class="keyword">by</span> Delegates.vetoable(<span class="string">"&lt;no name&gt;"</span>) &#123;</div><div class="line">        prop, old, new -&gt;</div><div class="line">        println(<span class="string">"<span class="subst">$old</span> -&gt; <span class="subst">$new</span>"</span>)</div><div class="line">        <span class="literal">false</span> <span class="comment">//返回true将和observable()效果一致</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//按上面的代码，赋值调用，输出</span></div><div class="line"><span class="comment">//&lt;no name&gt; -&gt; first</span></div><div class="line"><span class="comment">//&lt;no name&gt; -&gt; second</span></div></pre></td></tr></table></figure>
<h3 id="把属性储存在Map集合中"><a href="#把属性储存在Map集合中" class="headerlink" title="把属性储存在Map集合中"></a>把属性储存在Map集合中</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User1</span></span>(map: Map&lt;String, Any?&gt;) &#123;</div><div class="line">    <span class="keyword">val</span> name: String <span class="keyword">by</span> map</div><div class="line">    <span class="keyword">val</span> age: <span class="built_in">Int</span>     <span class="keyword">by</span> map</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//接受一个集合参数</span></div><div class="line"><span class="keyword">val</span> user = User(mapOf(</div><div class="line">    <span class="string">"name"</span> to <span class="string">"John Doe"</span>,</div><div class="line">    <span class="string">"age"</span>  to <span class="number">25</span></div><div class="line">))</div><div class="line"></div><div class="line"><span class="comment">//输出</span></div><div class="line">println(user.name) <span class="comment">//"John Doe"</span></div><div class="line">println(user.age)  <span class="comment">//25</span></div></pre></td></tr></table></figure>
<p>把只读的<strong>Map</strong>换成<strong>MutableMap</strong>，适用于<strong>var</strong>属性</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User1</span></span>(map: MutableMap&lt;String, Any?&gt;) &#123;</div><div class="line">    <span class="keyword">var</span> name: String <span class="keyword">by</span> map</div><div class="line">    <span class="keyword">var</span> age: <span class="built_in">Int</span>     <span class="keyword">by</span> map</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="局部委托属性（自-1-1-起）"><a href="#局部委托属性（自-1-1-起）" class="headerlink" title="局部委托属性（自 1.1 起）"></a>局部委托属性（自 1.1 起）</h3><p>可以使一个局部变量懒初始化</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">A1</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">isValid</span><span class="params">()</span></span>: <span class="built_in">Boolean</span></div><div class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">print</span><span class="params">()</span></span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">fun</span> <span class="title">example</span><span class="params">(a: ()</span></span> -&gt; A1) &#123;</div><div class="line">    <span class="comment">//延迟初始化局部变量</span></div><div class="line">    <span class="keyword">val</span> b <span class="keyword">by</span> lazy(a)</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (b.isValid()) &#123;</div><div class="line">        b.print()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://laosiji.tech/About-cao-cao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Whyte">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Whyte's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/About-cao-cao/" itemprop="url">“闲扯”一下曹操</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-08T12:49:50+08:00">
                2017-07-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/三国/" itemprop="url" rel="index">
                    <span itemprop="name">三国</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  210
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在看《军师联盟》，虽然出品方说是架空历史，但是有些还是属于真实的历史场景。至少没有过于政治正确的把曹操描写大奸大恶。反而有点在帮曹操说话，例如后世应该比较痛恨曹操杀了华佗，《三国演义》中好像没有表现出曹操的悔恨之意，而这表现了，曹冲因病早逝，曹操说了那么句，“孤后悔杀了那华佗呀”。虽然是因为私心，但还是表现了那么一点。<br>看了剧，自己也有感而发写上那么一小段：</p>
<blockquote>
<p>爱才之心，唯曹公不能比也。<br>用忠臣得以平天下，用谋士得以治天下。<br>忠臣易得，谋臣难得，呜呼哀哉奉孝，天下未定，斯人已逝矣。</p>
</blockquote>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://laosiji.tech/Java-is-today/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Whyte">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Whyte's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Java-is-today/" itemprop="url">Java代码判断日期是否是今天</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-07T19:31:15+08:00">
                2017-07-07
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  146
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>记录一小段代码，免得用到的时候，重复造轮子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isToDay</span><span class="params">(<span class="keyword">long</span> time)</span> </span>&#123;</div><div class="line">    <span class="keyword">long</span> now = System.currentTimeMillis();</div><div class="line">    SimpleDateFormat temp = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM"</span>);</div><div class="line">    <span class="comment">//先判断年月是否相等，再判断天</span></div><div class="line">    <span class="keyword">return</span> temp.format(<span class="keyword">new</span> Date(time)).equals(temp.format(<span class="keyword">new</span> Date(now))) &amp;&amp; (getDay(now) == ge(time));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 获取对应是哪天</div><div class="line"> *</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getDay</span><span class="params">(<span class="keyword">long</span> time)</span> </span>&#123;</div><div class="line">    Calendar calendar = Calendar.getInstance();</div><div class="line">    calendar.setTimeInMillis(time);</div><div class="line">    Formatter ft = <span class="keyword">new</span> Formatter(Locale.CHINA);</div><div class="line">    String dayStr = ft.format(<span class="string">"%1$td"</span>, calendar).toString();<span class="comment">//取天数并格式化</span></div><div class="line">    <span class="keyword">return</span> Integer.parseInt(dayStr);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>调用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line"></div><div class="line">    System.out.println(isToDay(<span class="keyword">new</span> Date().getTime()));<span class="comment">//true</span></div><div class="line"></div><div class="line">    <span class="comment">//加一天</span></div><div class="line">    Calendar calendar = Calendar.getInstance();</div><div class="line">    calendar.add(Calendar.DAY_OF_MONTH, <span class="number">1</span>);</div><div class="line">    System.out.print(isToDay(calendar.getTimeInMillis()));<span class="comment">//false</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://laosiji.tech/Kotlin-four/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Whyte">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Whyte's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Kotlin-four/" itemprop="url">跟我一起学Kotlin语法糖（四）——对象表达式和对象声明及数据类</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-04T21:58:39+08:00">
                2017-07-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kotlin/" itemprop="url" rel="index">
                    <span itemprop="name">Kotlin</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  1,278
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  5
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Kotlin中的匿名对象对应的是Java中的匿名内部类。<br>Kotlin中的数据类方便我们去保存数据。<br>接下来本文将和大家说一下，对象表达式和对象声明及数据类相关定义的语法糖。</p>
<h2 id="对象表达式和对象声明"><a href="#对象表达式和对象声明" class="headerlink" title="对象表达式和对象声明"></a>对象表达式和对象声明</h2><p>我们需要创建一个对某个类做了轻微改动的类的对象，而不用为之显式声明新的子类。Java用匿名内部类处理这种情况。Kotlin中则用对象表达式和对象声明。</p>
<ol>
<li>对象表达式是在使用他们的地方立即执行（及初始化）的</li>
<li>对象声明是在第一次被访问到时延迟初始化的</li>
<li>伴生对象的初始化是在相应的类被加载（解析）时，与Java静态初始化器的语义相匹配</li>
</ol>
<h3 id="对象表达式"><a href="#对象表达式" class="headerlink" title="对象表达式"></a>对象表达式</h3><p>先写一个Java中的匿名内部类，好和Kotlin中对象表达式作比较</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//声明一个抽象类</span></div><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//定义一个普通的变量</span></div><div class="line"><span class="keyword">int</span> i = <span class="number">1</span>;</div><div class="line"><span class="comment">//声明一个匿名内部类</span></div><div class="line">Person p = <span class="keyword">new</span> Person() &#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"play:"</span> + i);<span class="comment">//i不可修改</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line">p.play();<span class="comment">//play:1</span></div></pre></td></tr></table></figure>
<p>与上面Java的匿名内部类对应Kotlin中的匿名对象。和Java一样匿名对象中也可以访问同一作用域的变量，但是Kotlin更灵活，因为它有可变变量，不仅可以访问还可以修改。如上Java的不能直接修改变量，如下当Kotlin变量定义为<strong>var</strong>可以，<strong>val</strong>不可以。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">play</span><span class="params">()</span></span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//定义可变变量</span></div><div class="line"><span class="keyword">var</span> i: <span class="built_in">Int</span> = <span class="number">1</span></div><div class="line"><span class="comment">//对象表达式</span></div><div class="line"><span class="keyword">val</span> a:Person=<span class="keyword">object</span> : Person() &#123;</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">play</span><span class="params">()</span></span> &#123;</div><div class="line">        i++<span class="comment">//可以修改</span></div><div class="line">        println(<span class="string">"play:"</span> + i)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line">a.play() <span class="comment">//play:2</span></div></pre></td></tr></table></figure>
<p>接下来看Kotlin比Java更灵活。定义一个接口和抽象类，一个匿名对象搞定，而Java需要定义两个匿名内部类。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">play</span><span class="params">()</span></span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Move</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">walk</span><span class="params">()</span></span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//对象表达式</span></div><div class="line"><span class="keyword">val</span> a: Any = <span class="keyword">object</span> : Person(), Move &#123;</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">walk</span><span class="params">()</span></span> &#123;</div><div class="line">        println(<span class="string">"walk"</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">play</span><span class="params">()</span></span> &#123;</div><div class="line">        println(<span class="string">"play"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line"><span class="keyword">if</span> (a <span class="keyword">is</span> Person) &#123;</div><div class="line">    a.play()</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (a <span class="keyword">is</span> Move) &#123;</div><div class="line">    a.walk()</div><div class="line">&#125;</div><div class="line"><span class="comment">//play </span></div><div class="line"><span class="comment">//walk</span></div></pre></td></tr></table></figure>
<p>如果只是简单的需要一个对象，那么可以如下简写。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> b = <span class="keyword">object</span> &#123;</div><div class="line">    <span class="keyword">var</span> x: <span class="built_in">Int</span> = <span class="number">1</span></div><div class="line">    <span class="keyword">var</span> y: <span class="built_in">Int</span> = <span class="number">2</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line">println(b.x + b.y)<span class="comment">//3</span></div></pre></td></tr></table></figure>
<p>匿名对象可以作为函数或属性的返回类型，该函数或属性的实际类型会是匿名对象声明的超类型，如果没有声明任何超类型，就会是<strong>Any</strong>，这时在匿名对象中添加的成员将无法访问。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 私有函数，其返回类型是匿名对象类型</span></div><div class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span> = <span class="keyword">object</span> &#123;</div><div class="line">    <span class="keyword">val</span> x: String = <span class="string">"x"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 公有函数，其返回类型是 Any</span></div><div class="line"><span class="function"><span class="keyword">fun</span> <span class="title">publicF</span><span class="params">()</span></span> = <span class="keyword">object</span> &#123;</div><div class="line">    <span class="keyword">val</span> x: String = <span class="string">"x"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line"><span class="keyword">val</span> x1 = f().x        <span class="comment">//可以解析</span></div><div class="line"><span class="keyword">val</span> x2 = publicF()  <span class="comment">//不能解析引用的x</span></div></pre></td></tr></table></figure>
<h3 id="对象声明"><a href="#对象声明" class="headerlink" title="对象声明"></a>对象声明</h3><p>对象声明是用<strong>object</strong>关键词标记。调用对象中的方法直接使用<strong>名称.</strong>调用即可。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//对象声明</span></div><div class="line"><span class="keyword">object</span> Data &#123;</div><div class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">r</span><span class="params">()</span></span> &#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line">Data.r()</div></pre></td></tr></table></figure>
<blockquote>
<p>对象声明不能在局部作用域（即直接嵌套在函数内部），但是可以嵌套到其他对象声明或非内部类中。</p>
</blockquote>
<h4 id="伴生对象"><a href="#伴生对象" class="headerlink" title="伴生对象"></a>伴生对象</h4><p>类内部的对象声明可以用<strong>companion</strong>关键词标记，这样称之为伴生对象。伴生对象中的成员可通过只使用类名作为限定符来调用。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">F</span> </span>&#123;</div><div class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> Walk &#123;</div><div class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">()</span></span> &#123;</div><div class="line">            println(<span class="string">"walk"</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line">F.create()</div><div class="line"><span class="comment">//or</span></div><div class="line">F.Walk.create()</div><div class="line"><span class="comment">//walk</span></div></pre></td></tr></table></figure>
<p>也可以省略伴生对象的名称。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">F</span> </span>&#123;</div><div class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</div><div class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">()</span></span> &#123;</div><div class="line">            println(<span class="string">"walk"</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line">F.create()</div><div class="line"><span class="comment">//or</span></div><div class="line">F.Companion.create()</div><div class="line"><span class="comment">// walk</span></div></pre></td></tr></table></figure>
<p>还可以实现接口。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">F1</span> </span>&#123;</div><div class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> : Walk &#123;</div><div class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">()</span></span>&#123;</div><div class="line">            println(<span class="string">"walk"</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Walk</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">()</span></span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line">F.create()</div><div class="line"><span class="comment">//or</span></div><div class="line">F.Walk.create()</div><div class="line"><span class="comment">//walk</span></div></pre></td></tr></table></figure>
<h2 id="数据类"><a href="#数据类" class="headerlink" title="数据类"></a>数据类</h2><p>当我们需要创建一些只保存数据的类，这样就要用到Kotlin中数据类，用关键词<strong>data</strong>标记。<br>声明数据类必须满足以下条件：</p>
<ol>
<li>主构造函数需要至少有一个参数；</li>
<li>主构造函数的所有参数需要标记为 val 或 var；</li>
<li>数据类不能是抽象、开放、密封或者内部的；</li>
<li>（在1.1之前）数据类只能实现接口。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//定义一个数据类</span></div><div class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</div><div class="line"></div><div class="line"><span class="comment">//调用</span></div><div class="line"><span class="keyword">val</span> p = User(<span class="string">"Whyte"</span>, <span class="number">18</span>)</div><div class="line">println(p.name + <span class="string">" is "</span> + p.age)<span class="comment">//Whyte is 18</span></div><div class="line"></div><div class="line"><span class="comment">//也可以这样调用</span></div><div class="line"><span class="keyword">val</span> (name, age) = p</div><div class="line">println(name + <span class="string">" is "</span> + age)</div><div class="line"></div><div class="line">println(p)<span class="comment">//User(name=Whyte, age=18)</span></div></pre></td></tr></table></figure>
<p>编译器自动从主构造函数中声明的所有属性生成以下成员：</p>
<ol>
<li>equals()／hashCode()</li>
<li>toString() 格式是 如上代码输出 “User(name=Whyte, age=18)”</li>
<li>componentN() 函数 按声明顺序对应于所有属性</li>
<li>copy() 函数</li>
</ol>
<p>如果在类中或继承自这个类显式实现了这些函数时，则不会生成该函数。</p>
<blockquote>
<p>如果生成的类需要含有一个无参的构造函数，则所有的属性必须指定默认值</p>
</blockquote>
<h3 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h3><p>需要复制一个对象改变它的一些属性，但其余部分保持不变。<strong>copy()</strong>函数就是为此而生</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> newP = p.copy(age = <span class="number">19</span>)</div><div class="line"></div><div class="line">println(newP.name + <span class="string">" is "</span> + newP.age)</div><div class="line"><span class="comment">//Whyte is 19</span></div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://laosiji.tech/Kotlin-three/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Whyte">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Whyte's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Kotlin-three/" itemprop="url">跟我一起学kotlin语法糖（三）——优雅的定义类和继承</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-02T22:13:53+08:00">
                2017-07-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kotlin/" itemprop="url" rel="index">
                    <span itemprop="name">Kotlin</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  1,372
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>类可以包含：<strong>构造函数和初始化块</strong>、<strong>函数</strong>、<strong>属性</strong>、<strong>嵌套类</strong>和<strong>内部类</strong>、<strong>对象声明</strong>。<br>Kotlin中类的语法糖，相对Java还是有很多不同，简洁为主的Kotlin语法在类的定义上，省去了Java在定义实体类时必须初始化的一堆<strong>get</strong>、<strong>set</strong>方法。<br>特别是在继承的时候，覆盖方法时有对应的覆盖规则，可以按需覆盖<br>Kotlin在设计继承的时候，也遵循了<strong>Effective Java</strong>书中对于继承的规范建议</p>
<blockquote>
<p>要么为继承而设计，并提供文档说明，要么就禁止继承。</p>
</blockquote>
<p>接下来和大家分享Kotlin中定义类和继承等相关语法糖。</p>
<h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><p>Kotlin中类的定义和Java一样都是用的关键词<strong>class</strong>，但是一个类中没有任何内容的话，可以去掉花括号。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span></div></pre></td></tr></table></figure>
<h3 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h3><p>可以有一个<strong>主构造函数</strong>和一个或多个<strong>次构造函数</strong>。主构造函数是类头的一部分：跟在类名后面。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> <span class="keyword">constructor</span></span>(name: String) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果主构造函数没有任何注解或者可见性修饰符，可以省略constructor关键字。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">P1</span></span>(name: String) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果有的话constructor关键字则是必需的，并且这些修饰符在它前面</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">P2</span> <span class="keyword">private</span> <span class="keyword">constructor</span></span>(name: String) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>主构造函数中可以初始化构造参数，不能有其他代码的初始化</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1</span></span>(name: String, age: <span class="built_in">Int</span> = <span class="number">1</span>) &#123;</div><div class="line">    <span class="keyword">val</span> u = name.toUpperCase()</div><div class="line">    <span class="keyword">val</span> a = age</div><div class="line">&#125;</div><div class="line"><span class="comment">//调用</span></div><div class="line"><span class="keyword">val</span> c = C1(<span class="string">"d"</span>)</div><div class="line">println(c.u + <span class="string">"---"</span> + c.a)</div></pre></td></tr></table></figure>
<p>除了构造参数的其他初始化，可以放到以<strong>init</strong>关键字作为前缀的<strong>初始化块</strong>中</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>(name: String) &#123;</div><div class="line">    init &#123;</div><div class="line">        println(<span class="string">"name is :<span class="subst">$name</span>"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//调用</span></div><div class="line">C(<span class="string">"1"</span>)</div></pre></td></tr></table></figure>
<p>声明属性以及主构造函数初始化属性，简洁的语法</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C2</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">var</span> age: <span class="built_in">Int</span>) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="次构造函数"><a href="#次构造函数" class="headerlink" title="次构造函数"></a>次构造函数</h3><p>如果类有一个主构造函数，每个次构造函数需要调用主构造函数，直接调用或者通过别的次构造函数间接调用。调用到同一个类的另一个构造函数用<strong>this</strong>关键字</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span></span>(name: String) &#123;</div><div class="line">    <span class="keyword">constructor</span>(name: String, age: <span class="built_in">Int</span>) : <span class="keyword">this</span>(name) &#123;</div><div class="line">        println(name)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">constructor</span>(name: String, show: <span class="built_in">Boolean</span>) : <span class="keyword">this</span>(name, <span class="number">1</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="创建类的实例"><a href="#创建类的实例" class="headerlink" title="创建类的实例"></a>创建类的实例</h3><p>Kotlin中实例化对象，没有Java中的new关键字</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//调用无参构造函数</span></div><div class="line">a()</div><div class="line"><span class="comment">//调用有参构造函数</span></div><div class="line">p(<span class="string">"Whyte"</span>)</div></pre></td></tr></table></figure>
<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p>在Kotlin中所有类的父类都是<strong>Any</strong>，没有继承父类的类默认隐式继承<strong>Any</strong>。只有<strong>equals()</strong>、<strong>hashCode()</strong>和<strong>toString()</strong>三个成员，如果用到其他成员需要使用Kotlin的<strong>扩展函数</strong>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">equals</span><span class="params">(other: <span class="type">Any</span>?)</span></span>: <span class="built_in">Boolean</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.equals(other)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">hashCode</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.hashCode()</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">toString</span><span class="params">()</span></span>: String &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.toString()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>先声明一个父类，需要把父类用<strong>open</strong>关键词修饰，把父类放到类名的冒号之后。父类上的<strong>open</strong>标注与Java中final相反，它允许其他类从这个类继承。默认情况下，在 Kotlin中所有的类都是final。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Base</span></span>(p: <span class="built_in">Int</span>)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">E1</span></span>(p: <span class="built_in">Int</span>) : Base(p)</div></pre></td></tr></table></figure>
<h3 id="覆盖方法"><a href="#覆盖方法" class="headerlink" title="覆盖方法"></a>覆盖方法</h3><p>与 Java 不同，需要显式标注可覆盖的成员和覆盖后的成员，即超类中方法需要用<strong>open</strong>标注，子类中的覆盖的方法需要用<strong>override</strong>标注</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Base</span></span>(p: <span class="built_in">Int</span>)&#123;</div><div class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">v</span><span class="params">()</span></span> &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">nv</span><span class="params">()</span></span> &#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">E1</span></span>(p: <span class="built_in">Int</span>) : Base(p)&#123;</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">v</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.v()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>标记为<strong>override</strong>的成员是可再次被子类覆盖的。如果想禁止再次覆盖，使用<strong>final</strong>关键字</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">E1</span></span>(p: <span class="built_in">Int</span>) : Base(p) &#123;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">v</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.v()</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">E2</span></span>(p: <span class="built_in">Int</span>) : E1(p) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="覆盖属性"><a href="#覆盖属性" class="headerlink" title="覆盖属性"></a>覆盖属性</h3><p>覆盖属性和覆盖方法类似。每个超类中的属性可以是默认初始化的或具有getter方法的属性。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">F</span> </span>&#123;</div><div class="line">    <span class="keyword">open</span> <span class="keyword">val</span> x: <span class="built_in">Int</span> <span class="keyword">get</span>() = <span class="number">2</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span> : <span class="type">F</span></span>() &#123;</div><div class="line">    <span class="keyword">override</span> <span class="keyword">val</span> x: <span class="built_in">Int</span> = <span class="number">0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>继承接口时，可以在主构造函数中使用<strong>override</strong>关键字作为属性声明的一部分    </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Foo</span> </span>&#123;</div><div class="line">    <span class="keyword">val</span> count: <span class="built_in">Int</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar1</span></span>(<span class="keyword">override</span> <span class="keyword">val</span> count: <span class="built_in">Int</span>) : Foo</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar2</span> : <span class="type">Foo &#123;</span></span></div><div class="line">    <span class="keyword">override</span> <span class="keyword">var</span> count: <span class="built_in">Int</span> = <span class="number">0</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="覆盖规则"><a href="#覆盖规则" class="headerlink" title="覆盖规则"></a>覆盖规则</h3><p>在 Kotlin 中，实现继承有下述规则：</p>
<blockquote>
<p>如果一个类从它的直接超类继承相同成员的多个实现，它必须覆盖这个成员并提供其自己的实现。</p>
</blockquote>
<p>为了表示采用从哪个超类型继承的实现，我们使用由尖括号中超类型名限定的 super，如<strong>super<base></strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</div><div class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span> &#123; print(<span class="string">"A"</span>) &#125;</div><div class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">a</span><span class="params">()</span></span> &#123; print(<span class="string">"a"</span>) &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">B</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span> &#123; print(<span class="string">"B"</span>) &#125; <span class="comment">// 接口成员默认就是“open”的</span></div><div class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">b</span><span class="params">()</span></span> &#123; print(<span class="string">"b"</span>) &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>() : A(), B &#123;</div><div class="line">    <span class="comment">// 编译器要求覆盖 f()：</span></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>&lt;A&gt;.f() <span class="comment">// 调用 A.f()</span></div><div class="line">        <span class="keyword">super</span>&lt;B&gt;.f() <span class="comment">// 调用 B.f()</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h2><p>在Kotlin中和Java不同，可以用一个抽象成员覆盖一个非抽象的开放成员</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Base</span> </span>&#123;</div><div class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span> &#123;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">D</span> : <span class="type">Base</span></span>() &#123;</div><div class="line">    <span class="keyword">override</span> <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="嵌套类"><a href="#嵌套类" class="headerlink" title="嵌套类"></a>嵌套类</h2><p>类可以嵌套在其他类中，但是这样嵌套类不能访问外部类的成员。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">H</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">val</span> b: <span class="built_in">Int</span> = <span class="number">1</span></div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">G</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span> = <span class="number">3</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//输出</span></div><div class="line">println(H.G().f()) <span class="comment">//3</span></div></pre></td></tr></table></figure>
<h3 id="内部类"><a href="#内部类" class="headerlink" title="内部类"></a>内部类</h3><p>类可以添加<strong>inner</strong>关键词以便能够访问外部类的成员。但是这样内部类会持有对外部类的对象的引用。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">H</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">val</span> b: <span class="built_in">Int</span> = <span class="number">1</span></div><div class="line"></div><div class="line">    inner <span class="class"><span class="keyword">class</span> <span class="title">G</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">f</span><span class="params">()</span></span> = b</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//输出</span></div><div class="line">println(H().G().f()) <span class="comment">//1</span></div></pre></td></tr></table></figure>
<p>在 Kotlin 中类没有静态方法。需要调用静态方法，需要在类内声明了一个<strong>伴生对象</strong>。<br><br>下篇文章将和大家分享Kotlin中<strong>对象表达式和对象声明</strong>的相关语法糖。</p>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://laosiji.tech/Mac-skills/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Whyte">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Whyte's blogs">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Mac-skills/" itemprop="url">Mac 技巧集锦</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-02T12:12:32+08:00">
                2017-07-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Mac/" itemprop="url" rel="index">
                    <span itemprop="name">Mac</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  197
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Mac-OS-X-bash-基本命令失效后的修复"><a href="#Mac-OS-X-bash-基本命令失效后的修复" class="headerlink" title="Mac OS X -bash 基本命令失效后的修复"></a>Mac OS X -bash 基本命令失效后的修复</h2><p>具体不知到啥时候弄了啥，导致哪里出了错，竟然所有的-bash基本命令都失败了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-bash: ls :command not found</div></pre></td></tr></table></figure>
<p>在terminal里面输入如下命令，这样命令暂时可以用了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export PATH=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin</div></pre></td></tr></table></figure>
<p>赶紧用open -e ~/.bash_profile在文本编辑器里面打开.bash_profile文件。<br>更改PATH环境变量设置，添加上这一行。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export PATH=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11</div></pre></td></tr></table></figure>
<p>保存问题解决</p>
<h2 id="Mac-显示隐藏文件"><a href="#Mac-显示隐藏文件" class="headerlink" title="Mac 显示隐藏文件"></a>Mac 显示隐藏文件</h2><p>Command+Shift+. 可以显示隐藏文件、文件夹，再按一次，恢复隐藏；<br>Finder下使用Command+Shift+G 可以前往任何文件夹，包括隐藏文件夹。<br><a href="https://www.zhihu.com/question/24635640" target="_blank" rel="external">参考</a></p>
<p>未完，待续…</p>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="Whyte">
          <p class="site-author-name" itemprop="name">Whyte</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/whyteH" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://open.weixin.qq.com/qr/code/?username=WhyteTalk" target="_blank" title="WeChat">
                  
                    <i class="fa fa-fw fa-weixin"></i>
                  
                  WeChat
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Whyte</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>
<div class="host-by">
  <p>Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></p>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.1"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.1"></script>


  

</body>
</html>